<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>अनिक फायनान्शियल सर्व्हिसेस - अंतिम विश्लेषण</title>
    
    <!-- CSS Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;700&display=swap');
        
        :root {
            --primary-color: #0056b3;
            --primary-light: #e6f0ff;
            --positive-color: #28a745;
            --positive-light: #e9f7ec;
            --negative-color: #dc3545;
            --negative-light: #fdecea;
            --neutral-color: #ffc107;
            --neutral-light: #fff9e6;
            --white-bg: #ffffff;
            --light-bg: #f4f6f9;
            --text-color: #333;
            --text-muted: #6c757d;
            --border-color: #dee2e6;
            --shadow-sm: 0 4px 15px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        body { 
            font-family: 'Noto Sans Devanagari', sans-serif; 
            background-color: var(--light-bg); 
            color: var(--text-color); 
            margin: 0; 
            padding: 20px; 
        }
        .container { 
            max-width: 1200px; 
            margin: 20px auto; 
            background: var(--white-bg); 
            padding: 30px; 
            border-radius: 16px; 
            box-shadow: var(--shadow-md); 
        }
        .main-header { 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-bottom: 2px solid var(--primary-color); 
            padding-bottom: 15px; 
            margin-bottom: 25px; 
        }
        h1.main-title { 
            color: #004085; 
            margin: 0; 
            font-size: 1.8em; 
            font-weight: 700; 
        }
        .upload-section { text-align: center; padding: 25px; border: 2px dashed #007bff; border-radius: 8px; margin-bottom: 25px; background-color: #f8f9fa; }
        .upload-section p { font-weight: 500; }
        input[type="file"], input[type="password"] { display: block; width: calc(100% - 24px); max-width: 400px; margin: 12px auto; padding: 12px; border-radius: 6px; border: 1px solid #ccc; }
        button { background-color: #007bff; color: white; padding: 12px 30px; border: none; border-radius: 6px; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: background-color 0.3s; margin-top: 10px; }
        button:hover { background-color: #0056b3; }
        #printButton { background-color: var(--positive-color); display: block; margin: 30px auto 0; }
        .hidden { display: none; }
        
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { display: flex; align-items: center; padding: 20px; border-radius: 12px; box-shadow: var(--shadow-sm); transition: transform 0.3s, box-shadow 0.3s; position: relative; overflow: hidden; border: 1px solid transparent; }
        .kpi-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); }
        .kpi-card.theme-primary { background: linear-gradient(135deg, var(--primary-light), var(--white-bg)); border-color: var(--primary-light); }
        .kpi-card.theme-positive { background: linear-gradient(135deg, var(--positive-light), var(--white-bg)); border-color: var(--positive-light); }
        .kpi-card.theme-negative { background: linear-gradient(135deg, var(--negative-light), var(--white-bg)); border-color: var(--negative-light); }
        .kpi-icon { font-size: 2.5em; margin-right: 18px; display: flex; align-items: center; justify-content: center; width: 50px; height: 50px; flex-shrink: 0; }
        .kpi-icon svg { width: 100%; height: 100%; }
        .theme-primary .kpi-icon, .theme-primary .kpi-value { color: var(--primary-color); }
        .theme-positive .kpi-icon, .theme-positive .kpi-value { color: var(--positive-color); }
        .theme-negative .kpi-icon, .theme-negative .kpi-value { color: var(--negative-color); }
        .kpi-content { flex: 1; }
        .kpi-title { font-size: 0.95em; font-weight: 500; color: var(--text-muted); margin: 0 0 5px 0; }
        .kpi-value { font-size: 1.8em; font-weight: 700; margin: 0; }
        
        #report-content h3 { color: #004085; border-bottom: 1px solid #e0e0e0; padding-bottom: 8px; margin-top: 30px; font-weight: 700; font-size: 1.4em; }
        .report-main-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-top: 20px; }
        .section-box { background-color: #fdfdfd; padding: 25px; border: 1px solid var(--border-color); border-radius: 12px; }
        .section-title { font-size: 1.2em; font-weight: 700; color: #004085; margin: 0 0 20px 0; text-align: center; }

        .chart-bars { display: flex; justify-content: space-around; height: 180px; border-left: 2px solid var(--border-color); border-bottom: 2px solid var(--border-color); padding-left: 10px; }
        .bar-wrapper { display: flex; flex-direction: column; align-items: center; justify-content: flex-end; width: 25%; text-align: center; }
        .bar-value { font-size: 0.9em; font-weight: 700; color: #555; margin-bottom: 5px; }
        .bar { width: 50px; border-radius: 5px 5px 0 0; transition: height 0.7s ease-out; height: 0; }
        .bar.bar-primary { background-color: var(--primary-color); }
        .bar.bar-negative { background-color: var(--negative-color); }
        .bar-label { margin-top: 8px; font-weight: 500; font-size: 0.9em; }

        #recommendation-box { padding: 20px; margin-top: 15px; border-radius: 8px; font-size: 1.2em; text-align: center; font-weight: 700; border-left: 5px solid; }
        .recommendation-positive { background-color: var(--positive-light); color: #155724; border-color: var(--positive-color); }
        .recommendation-negative { background-color: var(--negative-light); color: #721c24; border-color: var(--negative-color); }
        .recommendation-neutral { background-color: var(--neutral-light); color: #856404; border-color: var(--neutral-color); }
        #decision-points { list-style: none; padding-left: 0; margin-top: 15px; }
        #decision-points li { padding: 12px; margin-bottom: 8px; border-radius: 6px; display: flex; align-items: flex-start; background-color: #f8f9fa; }
        #decision-points li::before { font-family: 'Arial'; font-weight: bold; margin-right: 15px; font-size: 1.5em; line-height: 1; }
        #decision-points li.negative::before { content: '❌'; }
        #decision-points li.positive::before { content: '✅'; }
        #decision-points li.neutral::before { content: 'ℹ️'; }
        
        #summary-table { width: 100%; border-collapse: collapse; }
        #summary-table td { padding: 12px; border: 1px solid #e0e0e0; font-size: 1.1em; vertical-align: middle; }
        #summary-table td:first-child { font-weight: 500; background-color: #f8f9fa; width: 45%; }
        #summary-table td:last-child { font-weight: 700; text-align: left; }
        .company-list { text-align: left !important; font-weight: normal !important; }
        .amount-negative { color: var(--negative-color); }

        .report-footer { margin-top: 30px; padding-top: 15px; border-top: 1px solid #ccc; text-align: center; font-size: 0.9em; color: var(--text-muted); }
        #loader { text-align: center; padding: 30px; }
        .spinner { border: 6px solid #f3f3f3; border-top: 6px solid #007bff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 15px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- FINAL PRINT STYLES --- */
        @media print {
            @page {
                size: A4;
                margin: 0.4in; /* Reduced margin for better fit */
            }
            body { font-size: 9.5pt; background: #fff; }
            .container { width: 100%; max-width: 100%; margin: 0; padding: 0; box-shadow: none; border: none; }
            .upload-section, #printButton, #loader { display: none; }
            
            .main-header { display: flex; border-bottom: 1px solid #ccc; margin-bottom: 15px; padding-bottom: 10px;}
            h1.main-title { font-size: 14pt; }
            
            #report-container { display: block !important; }
            #report-content { border: none; padding: 0; }
            
            .report-footer { display: block; position: fixed; bottom: 20px; left: 0.4in; right: 0.4in; text-align: center; border-top: 1px solid #ccc; padding-top: 8px; font-size: 8pt; color: #666; }
            
            .kpi-grid { grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
            .report-main-layout { grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }

            .kpi-card, .section-box, #decision-points li {
                padding: 12px;
                box-shadow: none;
                background: none;
                border: 1px solid var(--border-color);
                break-inside: avoid; /* Prevent breaking across pages */
            }
            .kpi-value { font-size: 1.5em; }
            .kpi-title { font-size: 0.9em; }
            h3, .section-title { font-size: 11pt; margin-bottom: 10px; padding-bottom: 5px; }
            #recommendation-box { padding: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-header">
            <h1 class="main-title"> अनिक फायनान्शियल सर्व्हिसेस - अंतिम विश्लेषण</h1>
        </div>
        <div class="upload-section">
            <p>ग्राहकाचा इक्वीफॅक्स रिर्पाट अपलोड करा नंतर फायनल रिर्पाट प्रिंट करून कर्ज मागणी गृपला शेअर करा.</p>
            <input type="file" id="pdfFile" accept=".pdf">
            <input type="password" id="pdfPassword" placeholder="PDF पासवर्ड (असल्यास टाका)">
            <button onclick="analyzeFile()">विश्लेषण करा</button>
        </div>
        <div id="loader" class="hidden"><p>कृपया थांबा... अचूक माहितीसाठी रिपोर्ट तपासत आहे...</p><div class="spinner"></div></div>
        
        <div id="report-container" class="hidden">
            <div id="report-content">
                <h3 style="text-align:center; border:none; margin-bottom: 10px;">ग्राहक पत विश्लेषण रिपोर्ट: <span id="headerCustomerName" style="color:var(--primary-color);"></span></h3>
                
                <div class="kpi-grid">
                    <div id="kpi-card-score" class="kpi-card theme-primary">
                        <div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M13 12V8h-2v4H7l5 6 5-6h-4z"></path></svg></div>
                        <div class="kpi-content"><p class="kpi-title">क्रेडिट स्कोअर</p><p id="kpi-score" class="kpi-value"></p></div>
                    </div>
                    <div class="kpi-card theme-primary">
                        <div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 6h-3V4c0-1.103-.897-2-2-2H9c-1.103 0-2 .897-2 2v2H4c-1.103 0-2 .897-2 2v11c0 1.103.897 2 2 2h16c1.103 0 2-.897 2-2V8c0-1.103-.897-2-2-2zM9 4h6v2H9V4zm11 15H4V8h16v11z"></path><path d="M12 10c-1.654 0-3 1.346-3 3s1.346 3 3 3 3-1.346 3-3-1.346-3-3-3zm0 4c-.551 0-1-.449-1-1s.449-1 1-1 1 .449 1 1-.449 1-1 1z"></path></svg></div>
                        <div class="kpi-content"><p class="kpi-title">एकूण कर्ज शिल्लक</p><p id="kpi-total-balance" class="kpi-value"></p></div>
                    </div>
                    <div class="kpi-card theme-positive">
                        <div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M13 17.615V21h-2v-3.385A9.943 9.943 0 0 1 3.385 13H0v-2h3.385A9.943 9.943 0 0 1 11 3.385V0h2v3.385A9.943 9.943 0 0 1 20.615 11H24v2h-3.385A9.943 9.943 0 0 1 13 17.615zM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path></svg></div>
                        <div class="kpi-content"><p class="kpi-title">एकूण मासिक हप्ता (EMI)</p><p id="kpi-monthly-emi" class="kpi-value"></p></div>
                    </div>
                     <div class="kpi-card theme-negative">
                        <div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2C6.486,2,2,6.486,2,12s4.486,10,10,10,10-4.486,10-10S17.514,2,12,2Zm3.707,12.293-1.414,1.414L12,13.414,9.707,15.707,8.293,14.293,10.586,12,8.293,9.707,9.707,8.293,12,10.586l2.293-2.293,1.414,1.414L13.414,12Z"></path></svg></div>
                        <div class="kpi-content"><p class="kpi-title">चालू कर्ज (एकूण)</p><p id="kpi-open-accounts" class="kpi-value"></p></div>
                    </div>
                    <div class="kpi-card theme-negative">
                        <div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 7h2v7h-2zm0 8h2v2h-2z"></path></svg></div>
                        <div class="kpi-content"><p class="kpi-title">थकीत खाती (Past Due)</p><p id="kpi-past-due" class="kpi-value"></p></div>
                    </div>
                    <div class="kpi-card theme-negative">
                        <div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M15 2H9C7.346 2 6 3.346 6 5v14c0 1.654 1.346 3 3 3h6c1.654 0 3-1.346 3-3V5c0-1.654-1.346-2-3-2zm-3 18c-.827 0-1.5-.673-1.5-1.5S11.173 17 12 17s1.5.673 1.5 1.5S12.827 20 12 20zm3-4H9V5h6v11z"></path></svg></div>
                        <div class="kpi-content"><p class="kpi-title">राइट-ऑफ रक्कम</p><p id="kpi-written-off" class="kpi-value"></p></div>
                    </div>
                </div>

                <div class="report-main-layout">
                    <div class="left-column">
                        <div class="section-box">
                            <h4 class="section-title">कर्ज मंजुरीसाठी शिफारस</h4>
                            <div id="recommendation-box"><p id="recommendation"></p></div>
                        </div>
                        <div class="section-box" style="margin-top:25px;">
                            <h4 class="section-title">शिफारशीचे आधारभूत मुद्दे (RBI नियमांनुसार)</h4>
                            <ul id="decision-points"></ul>
                        </div>
                    </div>
                    <div class="right-column">
                        <div class="section-box">
                            <h4 class="section-title">आर्थिक सारांश (Financial Summary)</h4>
                            <div class="chart-bars">
                                <div class="bar-wrapper"><div id="value-balance" class="bar-value">₹0</div><div id="bar-balance" class="bar bar-primary"></div><div class="bar-label">एकूण शिल्लक</div></div>
                                <div class="bar-wrapper"><div id="value-overdue" class="bar-value">₹0</div><div id="bar-overdue" class="bar bar-negative"></div><div class="bar-label">थकीत रक्कम</div></div>
                                <div class="bar-wrapper"><div id="value-writtenoff" class="bar-value">₹0</div><div id="bar-writtenoff" class="bar bar-negative"></div><div class="bar-label">राइट-ऑफ</div></div>
                            </div>
                        </div>
                        <div class="section-box" style="margin-top:25px;">
                             <h4 class="section-title">तपशीलवार माहिती</h4>
                             <table id="summary-table">
                                 <tr><td>वय (Age)</td><td id="customerAge"></td></tr>
                                 <tr><td>चालू कर्ज (कंपनीचे नाव)</td><td id="openAccountsCompany" class="company-list"></td></tr>
                                 <tr><td>एकूण थकीत रक्कम (Past Due Amount)</td><td id="overdueAmount" class="amount-negative"></td></tr>
                             </table>
                        </div>
                    </div>
                </div>

                <div class="report-footer">
                    <p><strong>टीप:</strong> वरील विश्लेषण हे रिपोर्टमधील माहितीवर आधारित असून केवळ सूचक आहे. अंतिम निर्णय घेण्यापूर्वी मूळ रिपोर्ट आणि ग्राहकाची कागदपत्रे तपासणे बंधनकारक आहे.</p>
                    <p>हा रिपोर्ट <span id="reportDate"></span> रोजी तयार करण्यात आला.</p>
                </div>
            </div>
            <button id="printButton" onclick="printReport()">रिपोर्ट प्रिंट/सेव्ह करा</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js`;

        // NO CHANGE IN ANALYSIS LOGIC
        async function analyzeFile() { const fileInput = document.getElementById('pdfFile'); if (fileInput.files.length === 0) { alert('कृपया एक PDF फाईल निवडा.'); return; } document.getElementById('loader').classList.remove('hidden'); document.getElementById('report-container').classList.add('hidden'); const password = document.getElementById('pdfPassword').value; const file = fileInput.files[0]; try { const arrayBuffer = await file.arrayBuffer(); const typedarray = new Uint8Array(arrayBuffer); const pdf = await pdfjsLib.getDocument({ data: typedarray, password }).promise; let fullText = ''; for (let i = 1; i <= pdf.numPages; i++) { const page = await pdf.getPage(i); const textContent = await page.getTextContent(); fullText += textContent.items.map(item => item.str).join(' '); } const analysisResult = analyzeCreditReportText(fullText); displayReport(analysisResult); } catch (error) { console.error("PDF processing error:", error); alert('PDF वाचण्यात अडचण येत आहे. पासवर्ड चुकीचा असू शकतो किंवा फाईल खराब असू शकते.'); } finally { document.getElementById('loader').classList.add('hidden'); } }
        function calculateAge(dobString, reportDateString) { try { const [dobDay, dobMonth, dobYear] = dobString.split('-').map(Number); const [repDay, repMonth, repYear] = reportDateString.split('-').map(Number); const dob = new Date(dobYear, dobMonth - 1, dobDay); const reportDate = new Date(repYear, repMonth - 1, repDay); let age = reportDate.getFullYear() - dob.getFullYear(); const m = reportDate.getMonth() - dob.getMonth(); if (m < 0 || (m === 0 && reportDate.getDate() < dob.getDate())) { age--; } return age; } catch (e) { return 0; } }
        function analyzeCreditReportText(text) { let cleanText = text; const legendMarker = "Glossary, Terms and Explanations:"; const markerIndex = text.indexOf(legendMarker); if (markerIndex !== -1) { cleanText = text.substring(0, markerIndex); } const result = { name: "माहिती आढळली नाही", score: "N/A", age: 0, openAccounts: 0, pastDueAccounts: 0, totalBalance: 0, overdueAmount: 0, monthlyInstallment: 0, writtenOffAmount: 0, openAccountInstitutions: [], otherCompanyOpenAccounts: 0, pastDueInstitutions: [], writtenOffInstitutions: [] }; const dobMatch = cleanText.match(/DOB:\s*(\d{2}-\d{2}-\d{4})/i); const reportDateMatch = cleanText.match(/DATE:\s*(\d{2}-\d{2}-\d{4})/i); if (dobMatch && reportDateMatch) { result.age = calculateAge(dobMatch[1], reportDateMatch[1]); } const normalizedText = cleanText.toLowerCase().replace(/\s+/g, ' '); if (normalizedText.includes('credit report summary')) { result.pastDueAccounts = parseInt(normalizedText.match(/number of past due accounts\s*:\s*(\d+)/)?.[1] || '0', 10); result.totalBalance = parseFloat(normalizedText.match(/total balance amount\s*:\s*(?:rs\.\s*)?([\d,.]+)/)?.[1].replace(/,/g, '') || '0'); result.overdueAmount = parseFloat(normalizedText.match(/total past due amount\s*:\s*(?:rs\.\s*)?([\d,.]+)/)?.[1].replace(/,/g, '') || '0'); result.monthlyInstallment = parseFloat(normalizedText.match(/total monthly instmt amt\s*:\s*(?:rs\.\s*)?([\d,.]+)/)?.[1].replace(/,/g, '') || '0'); result.writtenOffAmount = parseFloat(normalizedText.match(/total written off amount\s*:\s*(?:rs\.\s*)?([\d,.]+)/)?.[1].replace(/,/g, '') || '0'); } const nameRegex = /Consumer Name:\s*([A-Z\s]+?)(?=Personal Information|ASHABAI LAXMAN SHINDE)/i; result.name = (text.match(nameRegex) || ["", "माहिती आढळली नाही"])[1].trim(); result.score = (cleanText.match(/(?:cibil|equifax|experian)\s*score\s*:?\s*(\d{3})/) || ["", "N/A"])[1]; const accountChunks = cleanText.split(/Institution\s*:/); if (accountChunks.length > 1) { for (let i = 1; i < accountChunks.length; i++) { const chunk = accountChunks[i]; const institutionNameMatch = chunk.match(/^\s*([\w\s.&]+?)(?=Loan Category|Past Due Amount|Current Balance)/i); let companyName = ""; if (institutionNameMatch && institutionNameMatch[1]) { companyName = institutionNameMatch[1].replace(/Pvt\s*Ltd|Private\s*Limited|Limited|Services|Finance Bank/ig, '').trim(); } if (/Status\s*:\s*(Current Account|.*days past due)/i.test(chunk)) { if (companyName && !result.openAccountInstitutions.includes(companyName)) { result.openAccountInstitutions.push(companyName); if (!/anik/i.test(companyName)) { result.otherCompanyOpenAccounts++; } } } const statusLineMatch = chunk.match(/Status\s*:(.*?)(?=Disbursed Amount|Last Payment Date)/i); const statusLine = statusLineMatch ? statusLineMatch[1].toLowerCase() : ''; const historyLineMatch = chunk.match(/History 24 Months\s*:(.*?)(?=Name:|$)/i); const historyLine = historyLineMatch ? historyLineMatch[1].toLowerCase() : ''; if (statusLine.includes('past due')) { if (companyName && !result.pastDueInstitutions.includes(companyName)) { result.pastDueInstitutions.push(companyName); } } if (statusLine.includes('written off') || statusLine.includes('settled') || historyLine.includes('sub') || historyLine.includes('wdf') || historyLine.includes('dbf')) { if (companyName && !result.writtenOffInstitutions.includes(companyName)) { result.writtenOffInstitutions.push(companyName); } } } } result.openAccounts = result.openAccountInstitutions.length; return result; }
        function generateDecision(analysis) { const points = []; let recommendationText = "", recommendationClass = ""; if (analysis.age > 60) { recommendationText = "हाय रिस्क (High Risk)"; recommendationClass = "recommendation-negative"; points.push({ text: `ग्राहकाचे वय ${analysis.age} वर्षे आहे, जे 60 वर्षांपेक्षा जास्त आहे. कर्ज नाकारण्याची शिफारस आहे.`, type: "negative" }); } else if (analysis.pastDueInstitutions.length > 0 || analysis.writtenOffInstitutions.length > 0) { recommendationText = "हाय रिस्क (High Risk)"; recommendationClass = "recommendation-negative"; let negativeReasons = []; if (analysis.pastDueInstitutions.length > 0) { negativeReasons.push(`<strong>${analysis.pastDueInstitutions.join(', ')}</strong> या कंपनीचे कर्ज 'पास्ट ड्यू' (थकीत) आहे.`); } if (analysis.writtenOffInstitutions.length > 0) { negativeReasons.push(`<strong>${analysis.writtenOffInstitutions.join(', ')}</strong> या कंपनीचे कर्ज 'राईट-ऑफ', 'सेटल' किंवा 'सब-स्टँडर्ड' आहे.`); } points.push({ text: `${negativeReasons.join('<br>')}<br>त्यामुळे कर्ज नाकारण्याची शिफारस आहे.`, type: "negative" }); } else if (analysis.totalBalance > 120000) { recommendationText = "हाय रिस्क (High Risk)"; recommendationClass = "recommendation-negative"; points.push({ text: `एकूण बाकी रक्कम ₹ ${new Intl.NumberFormat('en-IN').format(analysis.totalBalance)} आहे (१,२०,००० पेक्षा जास्त).`, type: "negative" }); } else if (analysis.otherCompanyOpenAccounts >= 3) { recommendationText = "हाय रिस्क (High Risk)"; recommendationClass = "recommendation-negative"; points.push({ text: `अनिक वगळून, ग्राहकाचे कर्ज ${analysis.otherCompanyOpenAccounts} इतर कंपन्यांमध्ये चालू आहे, ज्यामुळे कर्जाचा बोजा जास्त आहे.`, type: "negative" }); } else if (analysis.totalBalance < 50000 && analysis.openAccounts > 0) { recommendationText = "मध्यम रिस्क (Medium Risk)"; recommendationClass = "recommendation-neutral"; points.push({ text: `एकूण थकबाकी ₹ ${new Intl.NumberFormat('en-IN').format(analysis.totalBalance)} (पन्नास हजारांपेक्षा कमी) आहे, ही एक सकारात्मक बाब आहे.`, type: "positive" }); points.push({ text: `तरीही, चालू कर्जे असल्याने, परतफेड क्षमता तपासून मर्यादित कर्ज देण्याचा विचार करता येईल.`, type: "neutral" }); } else if (analysis.otherCompanyOpenAccounts === 2) { recommendationText = "मध्यम रिस्क (Medium Risk)"; recommendationClass = "recommendation-neutral"; points.push({ text: `अनिक वगळून, ग्राहकाचे कर्ज २ इतर कंपन्यांमध्ये चालू आहे. परतफेड क्षमतेचे मूल्यांकन करणे आवश्यक आहे.`, type: "neutral" }); points.push({ text: `कर्ज मंजुरी फक्त ₹ 25,000 पर्यंत मर्यादित ठेवण्याची शिफारस आहे.`, type: "neutral" }); } else { recommendationText = "लो रिस्क (Low Risk)"; recommendationClass = "recommendation-positive"; points.push({ text: "रिपोर्ट पूर्णपणे स्वच्छ आहे आणि इतर कंपन्यांमध्ये कमी कर्ज आहेत.", type: "positive" }); points.push({ text: "कर्ज मंजुरी युनिटच्या अंतिम निर्णयावर अवलंबून असेल.", type: "positive" }); } return { recommendation: recommendationText, class: recommendationClass, points: points }; }

        function displayReport(analysis) {
            const formatCurrency = (num) => `₹ ${new Intl.NumberFormat('en-IN').format(num)}`;
            document.getElementById('headerCustomerName').textContent = analysis.name.toUpperCase();
            const scoreCard = document.getElementById('kpi-card-score');
            if (analysis.score === 'N/A' || analysis.score === "" ) { scoreCard.style.display = 'none'; } else { scoreCard.style.display = 'flex'; document.getElementById('kpi-score').textContent = analysis.score; }
            document.getElementById('kpi-open-accounts').textContent = `${analysis.openAccounts}`;
            document.getElementById('kpi-total-balance').textContent = formatCurrency(analysis.totalBalance);
            document.getElementById('kpi-monthly-emi').textContent = formatCurrency(analysis.monthlyInstallment);
            document.getElementById('kpi-past-due').textContent = analysis.pastDueAccounts;
            document.getElementById('kpi-written-off').textContent = formatCurrency(analysis.writtenOffAmount);
            document.getElementById('customerAge').textContent = analysis.age > 0 ? `${analysis.age} वर्षे` : 'N/A';
            document.getElementById('openAccountsCompany').innerHTML = analysis.openAccountInstitutions.length > 0 ? analysis.openAccountInstitutions.join('<br>') : 'एकही नाही';
            document.getElementById('overdueAmount').textContent = formatCurrency(analysis.overdueAmount);
            const decision = generateDecision(analysis);
            const recommendationBox = document.getElementById('recommendation-box');
            recommendationBox.className = '';
            recommendationBox.classList.add(decision.class);
            document.getElementById('recommendation').textContent = decision.recommendation;
            const pointsList = document.getElementById('decision-points');
            pointsList.innerHTML = '';
            decision.points.forEach(point => { const li = document.createElement('li'); li.innerHTML = point.text; li.classList.add(point.type); pointsList.appendChild(li); });
            setTimeout(() => {
                const maxVal = Math.max(analysis.totalBalance, analysis.overdueAmount, analysis.writtenOffAmount, 1);
                const balanceHeight = (analysis.totalBalance / maxVal) * 100;
                const overdueHeight = (analysis.overdueAmount / maxVal) * 100;
                const writtenOffHeight = (analysis.writtenOffAmount / maxVal) * 100;
                document.getElementById('bar-balance').style.height = `${balanceHeight}%`;
                document.getElementById('bar-overdue').style.height = `${overdueHeight}%`;
                document.getElementById('bar-writtenoff').style.height = `${writtenOffHeight}%`;
            }, 100);
            document.getElementById('value-balance').textContent = formatCurrency(analysis.totalBalance);
            document.getElementById('value-overdue').textContent = formatCurrency(analysis.overdueAmount);
            document.getElementById('value-writtenoff').textContent = formatCurrency(analysis.writtenOffAmount);
            document.getElementById('reportDate').textContent = new Date().toLocaleString('mr-IN', { dateStyle: 'short', timeStyle: 'medium' });
            document.getElementById('report-container').classList.remove('hidden');
        }
        
        function printReport() {
            window.print();
        }
    </script>
</body>
</html>